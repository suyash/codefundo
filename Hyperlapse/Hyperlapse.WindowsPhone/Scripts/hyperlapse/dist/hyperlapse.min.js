!function(e,n,o){"use strict";Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return 180*this/Math.PI};var t=Math.pow,a=[].join,i={}.toString,r=[].push,l={elevation:new o.ElevationService,streetView:new o.StreetViewService,directions:new o.DirectionsService},c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAgCAMAAADaHo1mAAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMAQL+AEO9g359QMHCvzyCP56CEoQAAAj5JREFUeF61ltmOqzAQBdvd3s1S//+1d5JgzDBhpDsi5wlKqAs4GJB74mMCgpPLLC3rVyYrfxIszgEmV3EKamYKhLz8yQFcXYCfCOZfmwZg9wr8TKg7qIFQ7xVs83vyXOVWgUE7guj/VjPwtjwfCJfdm1mrvwHx7hXvgI1VM4tepLRWmzTI7wUWUA2gbpu1g7qBNrNlHYKS0BlCFNEpJVFoF9VnL+IzEN+CmoK5kiCURaQLVubHXoDmXS3lqhs/M22lA+4IphdYAuXhTaCyCyLh2WFk27gSGCx7SSSR9Qzy1l0EShf4wLpT1wXxbfV0sALlDKoHfYEE1gXxKZOopOalC9afggKhgwpYAe3AATaemnwQrOC8JbKTngDp7R1iB4CeweSAuh07BAqq2k/+UFlP1GdWA3yHCvoNzDAJkEddXdDhSAS0g6xmCsm/mhsCa2cg61ajT6zSBQbBnwzpVLOBygLkIaDUE6jiZwjNlRmTXVAA+9knoZ4EoodXC6QnCP4IROIMQJMhkLAPG8lAKCdBhb6wIjgRN0AbrVXAHwWNYViOBqblm0BiL9EF4uZhPYI+NvsuWPqw7MS73KSnJIDZinNt2uckSGYTyY2j5g56ZmCu2+CkJrICcF6/cQoAoFOrO8yquhaRC1BMFbYK7ZHnAqirfsUWOce5Kv+RmEhrdE7p9d+bDG3vnHa7oEDuoMF0u2CCUXX6gEChjB3aJ65g7sCHD5TsAF361zXK/YkAas+FV+QTWXICYPr9T+0fyZwmnCMT3PEAAAAASUVORK5CYII=",s="&copy; 2014 Google",u=function(e){if(e instanceof o.LatLng)return e;var n="[object Array]"===i.call(e)?e[0]:e.lat,t="[object Array]"===i.call(e)?e[1]:e.lng;return new o.LatLng(n,t)},f=function(e){if(!e)return w.defaults;var n={};for(var o in w.defaults)n[o]=e[o]||w.defaults[o];return n},d=function(){return e.WebGLRenderingContext&&n.createElement("canvas").getContext("experimental-webgl")?new THREE.WebGLRenderer:(console.info("WebGL not available, using CanvasRenderer"),new THREE.CanvasRenderer)},g=function(e,n,t,a){l.directions.route({origin:e,destination:n,travelMode:o.DirectionsTravelMode.DRIVING},function(e,n){n===o.DirectionsStatus.OK?t(e):a("No Directions Result")})},h=function(e,n,t){l.streetView.getPanoramaByLocation(e,50,function(e,a){a===o.StreetViewStatus.OK?n({heading:e.tiles.centerHeading,pano:e.location.pano,copyright:e.copyright,location:e.location.latLng,pitch:e.tiles.originPitch}):t("Could not load panorama")})},p=function(e){var o=n.createElement("canvas"),a=t(2,e),i=t(2,e-1);o.width=416*a,o.height=416*i;var r=o.getContext("2d");return r.translate(o.width,0),r.scale(-1,1),o},v=function(e,n,o,i,r){for(var l=3===n?7:t(2,n),c=t(2,n-1),s=p(n),u=s.getContext("2d"),f=0,d=l*c,g=function(e,n,t){u.drawImage(t,512*e,512*n),f++,r&&r.call&&r.call({},100*f/d),f===d&&o&&o.call&&o.call({},s)},h=function(o,t){var i=a.call(["http://maps.google.com/cbk?output=tile&panoid=",e,"&zoom=",n,"&x=",o,"&y=",t,"&",Date.now()],""),r=new Image;r.addEventListener("load",function(){g(o,t,this)}),r.crossOrigin="",r.src=i},v=0;l>v;v++)for(var m=0;c>m;m++)h(v,m)},m=function(e){for(var n=[],o=0;o<e.length;o++)e[o]&&r.call(n,e[o]);return n},A=function(e,n,t){l.elevation.getElevationForLocations({locations:e},function(e,a){a===o.ElevationStatus.OK?n(e):a===o.ElevationStatus.OVER_QUERY_LIMIT?(n(null),t("Cannot use elevation, query limit exceeded")):t(a)})},w=function(e,t,a,l){var p=new THREE.MeshBasicMaterial;p.map=new THREE.Texture,p.side=THREE.DoubleSide,p.overdraw=!0;var w=f(t),C=a||w.onError,E=l||w.onProgress,y=new THREE.Mesh(new THREE.SphereGeometry(w.radius,w.horizontalSegments,w.verticalSegments),p),L=new THREE.Scene,R=new THREE.PerspectiveCamera(w.fov,w.width/w.height,w.minDistance,w.maxDistance),S=d(),D=[],M=0,b=[],x=0,F=!0,T=!0,H=!1,B=!1,I=!1,V=0,P=0,z=0,O=Date.now(),K=Math.floor(1e3/w.speed),k=0;L.add(y),L.add(R),S.autoClearColor=!1,S.setSize(w.width,w.height),e.appendChild(S.domElement),e.style.position="relative";var j=e.appendChild(new Image);j.src=c,j.style.position="absolute",j.style.bottom="10px",j.style.left="8px",e.appendChild(j);var X=e.appendChild(n.createElement("div"));X.innerHTML=s,X.style.backgroundColor="rgba(200, 200, 200, 0.5)",X.style.color="black",X.style.position="absolute",X.style.bottom="3px",X.style.right=0,X.style.padding="5px",X.style.fontSize="10px";var Y=function(){D=[],M=0,x=0,F=!0,H=!1,B=!1,T=!0,I=!1,V=0,P=0,z=0},q=function(e){for(var n=[],t=function(e,n,t){var a=e.lat().toRad(),i=e.lng().toRad(),r=n.lat().toRad(),l=n.lng().toRad(),c=a+t*(r-a),s=i+t*(l-i);return new o.LatLng(c.toDeg(),s.toDeg())},a=e.legs,i=e.overview_path,l=0,c=0;c<a.length;c++)l+=a[c].distance.value;var s=l/w.maxPoints;s=s<w.distanceBetweenPoints?w.distanceBetweenPoints:s;var u=0,f=0;for(c=0;c<i.length-1;c++){var d=i[c],g=i[c+1];if(u=o.geometry.spherical.computeDistanceBetween(d,g),f>0)if(f>u)f-=u;else{var h=t(d,g,f/u);r.call(n,h),d=h,u=o.geometry.spherical.computeDistanceBetween(d,g),f=0}else{var p=Math.floor(u/s);if(p>0){for(var v=0;p>v;v++){var m=v/p;(m>0||0===m&&0===c)&&r.call(n,t(d,g,m))}f=u-p*s}else f=s-u}}return r.call(n,i[i.length-1]),n},N=function(e,n){for(var o=e.length,t=0,a=[],i="",r=function(e,r){h(e,function(e){i!==e.pano?(a[r]=e,i=e.pano,E(50*(t++ +1)/o)):a[r]=null,t===o&&n(a)},C)},l=0;o>l&&H;l++)r(e[l],l)},Q=function(){w.onRouteLoad&&w.onRouteLoad.call&&w.onRouteLoad.call()},U=function(e,n){if(!I){T=!1,Q(),D=e;for(var o=e.length,t=0,a=function(a){v(a.pano,w.quality,function(i){a.image=i,E(50+50*(t++ +1)/o),t===o&&(b=e,x=o,n())},C)},i=0;i<e.length;i++)a(e[i])}},G=function(){p.map.image=b[M].image,p.map.needsUpdate=!0;var e=u(w.lookat);if(P=w.lookat?o.geometry.spherical.computeHeading(b[M].location,e):0,b[M].elevation){var n=V-b[M].elevation+w.elevationOffset,t=o.geometry.spherical.computeDistanceBetween(b[M].location,e),a=Math.atan(Math.abs(n/t)).toDeg();z=0>n?-a:a}},W=function(){var e=M/x,n=w.position.x+w.offset.x*e,o=w.position.y+w.offset.y*e,t=w.offset.z.toRad()*e,a=w.lookat?P-b[M].heading+n:n,i=z+o;i=Math.max(-85,Math.min(85,i));var r=(90-i).toRad(),l=a.toRad();R.lookAt(new THREE.Vector3(500*Math.sin(r)*Math.cos(l),500*Math.cos(r),500*Math.sin(r)*Math.sin(l))),R.rotation.z=w.rotationComp?t-w.rotationComp:t,y.rotation.z=b[M].pitch.toRad(),S.render(L,R)},J=function(){G(),F?++M===x&&(M=x-1,F=!F):-1===--M&&(M=0,F=!F),w.onFrameChange&&w.onFrameChange.call&&w.onFrameChange.call({},M+1,x)},Z=function(){var e=O;O=Date.now(),k+=O-e,k>=K&&B&&(J(),k=0),W(),requestAnimationFrame(Z)},_=function(){var n=0,o=0,t=0,a=0,i=!1,r=function(e){i||H||(i=!0,t=e.clientX,a=e.clientY,n=w.position.x,o=w.position.y,B&&(B=!1))},l=function(e){if(i&&!H){var r=w.fov/200,l=(t-e.clientX)*r,c=(e.clientY-a)*r;w.position.x=n+l,w.position.y=o+c}},c=function(){i&&!H&&(w.position.x=0,w.position.y=0,i=!1,B||(B=!0))};e.addEventListener("mousedown",r),e.addEventListener("mousemove",l),e.addEventListener("mouseup",c)},$=function(){H=!1,w.onLoad&&w.onLoad.call&&w.onLoad.call(),Z(),w.explore&&_()},en=function(){H||B||(H=!0,g(u(w.start),u(w.end),function(e){var n=q(e.routes[0]);N(n,function(e){if(e=m(e),w.elevation){for(var n=[],o=0;o<e.length;o++)n[o]=e[o].location;A(n,function(n){if(n)for(var o=0;o<n.length;o++)e[o].elevation=n[o].elevation;else w.elevation=!1;A([u(w.lookat)],function(n){n&&(V=n[0].elevation),U(e,$)},C)},C)}else U(e,$)})},C))},nn=function(){H||(B=!0)},on=function(){B=!1},tn=function(){return T?(I=!0,!0):!1},an=function(){return T?(I=!1,!0):!1};en();var rn=function(){Y(),en()},ln=function(e,n){S.setSize(e,n)};return{play:nn,pause:on,isLoading:function(){return H},isPlaying:function(){return B},onLoad:function(e){"[object Function]"===i.call(e)&&(w.onLoad=e)},onMidway:function(e){"[object Function]"===i.call(e)&&(w.onRouteLoad=e)},onProgress:function(e){"[object Function]"===i.call(e)&&(E=e)},onError:function(e){"[object Function]"===i.call(e)&&(C=e)},onFrame:function(e){"[object Function]"===i.call(e)&&(w.onFrameChange=e)},recreate:rn,pauseLoad:tn,resumeLoad:an,resize:ln}};w.defaults={width:e.innerWidth,height:e.innerHeight,fov:70,minDistance:1,maxDistance:1100,radius:500,horizontalSegments:60,verticalSegments:40,distanceBetweenPoints:5,maxPoints:100,speed:15,start:[50.39661,-105.11520000000002],end:[50.39656,-105.01267000000001],lookat:[50.4033146934618,-105.06006622558596],quality:2,position:{x:0,y:0},offset:{x:0,y:0,z:0},elevation:!0,elevationOffset:0,rotationComp:0,explore:!1,onError:function(e){console.error(e)},onProgress:function(e){console.log("Loaded:",e,"%")},onCancel:function(){console.info("Loading cancelled, call create to reload")},onRouteLoad:function(){console.info("Half Done!!!")},onLoad:function(){console.info("All Done, Call play to rock your world!!!")},onFrameChange:function(e,n){console.info("Showing Frame",e,"of",n,"frames")}},e.hyperlapse=w}(window,document,google.maps);